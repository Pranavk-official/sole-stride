<section class="breadcrumb-option">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-chevron p-3 bg-body-tertiary rounded-2">
        <li class="breadcrumb-item">
          <a class="link-body-emphasis" href="/admin">
            <svg class="bi" width="16" height="16">
              <use xlink:href="#house-door-fill"></use>
            </svg>
            <span class="visually-hidden">Dashboard</span>
          </a>
        <li class="breadcrumb-item active" aria-current="page">
          Attributes
        </li>
      </ol>
    </nav>
  </div>
</section>

<div class="container d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">
    <%= locals.title ? locals.title : 'Attribute Management' %>
  </h1>
  <div class="btn-group btn-toolbar mb-2 mb-md-0">
    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#addAttributeModal">Add Brand</button>
    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addAttributeModal">Add Color</button>
    <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#addAttributeModal">Add Attributes</button>
  </div>
</div>


<!-- Atribute List -->

<section id="attributeSection">
  <div class="container row">
    <div class="col">
      <div class="container table-responsive">
        <table class="table table-hover table-sm table-striped">
          <legend>Color Attribute</legend>
          <thead>
            <tr class="text-center align-middle">
              <th>Color</th>
              <th>Hex</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% colors.forEach((color,index) => { %>
            <tr class="text-center align-middle">
              <td><%- color.name %></td>
              <td>
                <%- color.hex %>
              </td>
              <td class="<%- color.isDeleted ? 'text-danger' : 'text-success' %>"><%- color.isDeleted ? 'Unlisted' : 'Listed' %></td>
              <td>
                <div class="btn-group">
                  <button data-color-id="<%- color._id %>" data-bs-target="#editColorModal" data-bs-toggle="modal" type="button" class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i></button>
                  <% if (color.isDeleted) { %>
                  <button id="toggleListColor" onclick="toggleListing('<%- color._id %>', 'color')" type="button" class="btn btn-sm btn-outline-success"><i class="bi bi-bookmark-plus"></i></button>
                  <% } else { %>
                  <button id="toggleListColor" onclick="toggleListing('<%- color._id %>', 'color')" type="button" class="btn btn-sm btn-outline-danger"><i class="bi bi-bookmark-dash"></i></button>
                  <% } %>
                  <button type="button" onclick="deleteColor('<%- color._id%>')" class="btn btn-sm btn-danger" data-color-id="<%- color._id %>"><i class="bi bi-trash"></i></button>
                </div>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col">
      <div class="container table-responsive">
        <table class="table table-hover table-sm table-striped">
          <legend>Size Attribute</legend>
          <thead>
            <tr class="text-center align-middle">
              <th>Size</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% sizes.forEach((size,index) => { %>
            <tr class="text-center align-middle">
              <td><%- size.value %></td>
              <td class="<%- size.isDeleted ? 'text-danger' : 'text-success' %>"><%- size.isDeleted ? 'Unlisted' : 'Listed' %></td>
              <td>
                <div class="btn-group">
                  <button id="editSizeButton" type="button" class="btn btn-sm btn-warning" data-size-id="<%- size._id %>" data-bs-toggle="modal" data-bs-target="#editSizeModal"><i class="bi bi-pencil"></i></button>
                  <% if (size.isDeleted) { %>
                  <button id="toggleListSize" onclick="toggleListing('<%- size._id %>', 'size')" type="button" class="btn btn-sm btn-outline-success"><i class="bi bi-bookmark-plus"></i></button>
                  <% } else { %>
                  <button id="toggleListSize" onclick="toggleListing('<%- size._id %>', 'size')" type="button" class="btn btn-sm btn-outline-danger"><i class="bi bi-bookmark-dash"></i></button>
                  <% } %>
                  <button type="button" onclick="deleteSize('<%- size._id%>')" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                </div>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col">
      <div class="container table-responsive">
        <table class="table table-hover table-sm table-striped">
          <legend>Brands</legend>
          <thead>
            <tr class="text-center align-middle">
              <th>Brand</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% brands?.forEach((brand,index) => { %>
            <tr class="text-center align-middle">
              <td><%- brand.name %></td>
              <td class="<%- brand.isActive ? 'text-danger' : 'text-success' %>"><%- brand.isActive ? 'Unlisted' : 'Listed' %></td>
              <td>
                <div class="btn-group">
                  <button id="editBrandButton" type="button" class="btn btn-sm btn-warning" data-brand-id="<%- brand._id %>" data-bs-toggle="modal" data-bs-target="#editBrandModal"><i class="bi bi-pencil"></i></button>
                  <% if (brand.isActive) { %>
                  <button id="toggleListBrand" onclick="toggleListing('<%- brand._id %>', 'brand')" type="button" class="btn btn-sm btn-outline-success"><i class="bi bi-bookmark-plus"></i></button>
                  <% } else { %>
                  <button id="toggleListBrand" onclick="toggleListing('<%- brand._id %>', 'brand')" type="button" class="btn btn-sm btn-outline-danger"><i class="bi bi-bookmark-dash"></i></button>
                  <% } %>
                  <button type="button" onclick="deleteBrand('<%- brand._id%>')" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                </div>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- End Attribute List -->

<!-- Add Atribute Modal -->
<div class="modal fade" id="addAttributeModal" tabindex="-1" aria-labelledby="addAttributeModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAttributeModalLabel">Add Attribute</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card">
          <form id="addAttributeForm" class="card-body" action="/admin/attributes/add-attribute" method="POST">
            <div class="row">
              <fieldset class="col card mx-2">
                <legend>Color</legend>
                <div class="mb-3">
                  <label for="colorName" class="form-label">Color</label>
                  <input name="colorName" type="text" class="form-control" id="colorName">
                </div>
                <div class="mb-3">
                  <label for="colorHex" class="form-label">Color Hex</label>
                  <input name="colorHex" type="color" class="form-control" id="colorHex">
                </div>
              </fieldset>
              <fieldset class="col card mx-2">
                <legend>Size</legend>
                <div class="mb-3">
                  <label for="size" class="form-label">Size</label>
                  <input name="size" type="number" min="6" class="form-control" id="size">
                </div>
              </fieldset>
              <fieldset class="col card mx-2">
                <legend>Brand</legend>
                <div class="mb-3">
                  <label for="brand" class="form-label">Brand</label>
                  <input name="brand" type="text" class="form-control" id="brand">
                </div>
              </fieldset>
            </div>
            <!-- Add more form fields as needed -->
            <button type="submit" class="btn btn-primary m-2 w-100">Add Attribute</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Add Atribute Modal -->

<!-- Edit Color Modal -->
<div class="modal fade" id="editColorModal" tabindex="-1" aria-labelledby="editColorModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editColorModalLabel">Edit Color Attribute</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card">
          <form id="editColorForm" class="card-body" method="POST">
            <div class="row">
              <fieldset class="col card mx-2">
                <legend>Color</legend>
                <div class="mb-3">
                  <label for="colorName" class="form-label">Color</label>
                  <input name="colorName" type="text" class="form-control" id="colorNameEdit" required>
                </div>
                <div class="mb-3">
                  <label for="colorHex" class="form-label">Color Hex</label>
                  <input name="colorHex" type="color" class="form-control" id="colorHexEdit" required>
                </div>
              </fieldset>
            </div>
            <!-- Add more form fields as needed -->
            <button type="submit" class="btn btn-primary m-2 w-100">Add Attribute</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Edit Color Modal -->

<!-- Edit Size -->
<div class="modal fade" id="editSizeModal" tabindex="-1" aria-labelledby="editSizeModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editSizeModal2Label">Edit Size Attribute</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card">
          <form id="editSizeForm" class="card-body" method="POST">
            <div class="row">
              <fieldset class="col card mx-2">
                <legend>Size</legend>
                <div class="mb-3">
                  <label for="size" class="form-label">Size</label>
                  <input name="size" type="number" min="6" class="form-control" id="sizeEdit" required>
                </div>
              </fieldset>
            </div>
            <!-- Add more form fields as needed -->
            <button type="submit" class="btn btn-primary m-2 w-100">Add Attribute</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Edit Size -->

<!-- Edit Brand -->
<div class="modal fade" id="editBrandModal" tabindex="-1" aria-labelledby="editBrandModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editBrandModalLabel">Edit Size Attribute</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card">
          <form id="editBrandForm" class="card-body" method="POST">
            <div class="row">
              <fieldset class="col card mx-2">
                <legend>Brand</legend>
                <div class="mb-3">
                  <label for="brand" class="form-label">Brand</label>
                  <input name="brand" type="text" class="form-control" id="brandEdit" required>
                </div>
              </fieldset>
            </div>
            <!-- Add more form fields as needed -->
            <button type="submit" class="btn btn-primary m-2 w-100">Edit Brand</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Brand Size -->

<script defer>
  function toggleListing(id, type) {
    console.log(type);
    Swal.fire({
      title: 'Are you sure?',
      text: `"You want to list/unlist ${type}!"`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, toggle it!'
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/admin/attributes/toggleListing/${type}/${id}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
            },
          })
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            
            Swal.fire({
              icon: 'success',
              title: 'Success',
              text: data.message.toUpperCase(),
            }).then(()=>{
              location.assign('/admin/attributes')
            });
          })
          .catch(error => {
            Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: 'Something went wrong!',
            });
          });
      }
    });
  }

  const editColorModal = document.getElementById('editColorModal');

  editColorModal.addEventListener('show.bs.modal', async (e) => {
    const editColorButton = e.relatedTarget;

    const colorId = editColorButton.getAttribute('data-color-id');
    try {
      const response = await fetch(`/admin/attributes/color/${colorId}`);
      if (!response.ok) {
        throw new Error('Failed to fetch color');
      }
      const color = await response.json();
      document.getElementById('colorNameEdit').value = color.name;
      document.getElementById('colorHexEdit').value = color.hex;
      document.getElementById('editColorForm').action = `/admin/attributes/color/${colorId}?_method=PUT`;
    } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: error.message
      });
    }
  });
  editSizeModal.addEventListener('show.bs.modal', async (e) => {
    const editSizeButton = e.relatedTarget;

    const sizeId = editSizeButton.getAttribute('data-size-id');
    try {
      const response = await fetch(`/admin/attributes/size/${sizeId}`);
      if (!response.ok) {
        throw new Error('Failed to fetch size');
      }
      const size = await response.json();
      document.getElementById('sizeEdit').value = size.value;
      document.getElementById('editSizeForm').action = `/admin/attributes/size/${sizeId}?_method=PUT`;
    } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: error.message
      });
    }
  });
  editBrandModal.addEventListener('show.bs.modal', async (e) => {
    const editBrandButton = e.relatedTarget;

    const brandId = editBrandButton.getAttribute('data-brand-id');
    try {
      const response = await fetch(`/admin/attributes/brand/${brandId}`);
      if (!response.ok) {
        throw new Error('Failed to fetch brand');
      }
      const brand = await response.json();
      document.getElementById('brandEdit').value = brand.name;
      document.getElementById('editBrandForm').action = `/admin/attributes/brand/${brandId}?_method=PUT`;
    } catch (error) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: error.message
      });
    }
  });
</script>